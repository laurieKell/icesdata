---
title: "ICES Stocks - Operating Models"
author: "L Kell"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{ICES Stocks - Operating Models}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
bibliography: refs.bib
---

```{r, setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  error = FALSE,
  eval = TRUE,
  cache = TRUE,
  cache.path = "cache/operating-models-",
  fig.path = "figures/operating-models-",
  fig.width = 10,
  fig.height = 12,
  dev = "png"
)

iFig = 0
iTab = 0
```

```{r, libraries}
library(icesdata)
library(FLCore)
library(FLBRP)
library(FLife)
library(plyr)
library(ggplot2)
library(scales)

# Set default theme for all plots
theme_set(theme_ices(base_size = 12))

if (requireNamespace("FLCandy", quietly = TRUE)) {
  library(FLCandy)
}
if (requireNamespace("statcomp", quietly = TRUE)) {
  library(statcomp)
}
```

## Introduction

ICES Category 1 stock assessments, analytical age based assessments that have been benchmarked.

This vignette demonstrates the construction of operating models for ICES stocks.

**Note:** This vignette requires external data files and FLCandy functions.

```{r, data-load}
# Load ICES data using standard data() function
data(icesdata)
data(info)
data(spp)
data(lw)

# Set up vignette data directory for saving outputs
vignetteDataDir = system.file("data/vignette-outputs", package = "icesdata")
if (!dir.exists(vignetteDataDir) || vignetteDataDir == "") {
  vignetteDataDir = file.path("data", "vignette-outputs")
  if (!dir.exists(vignetteDataDir)) {
    dir.create(vignetteDataDir, recursive = TRUE)
  }
}
```

## $SPR_{0}$ Entropy

```{r, spr0-entropy, fig.height=2.25, eval=FALSE}
# This section requires additional data and functions
# if (exists("spr0") && requireNamespace("statcomp", quietly = TRUE)) {
#   entropy <- plyr::ddply(spr0, .(.id, wg, species.group), with,
#     data.frame("SPR0" = permutation_entropy(
#       ordinal_pattern_distribution(x = data, ndemb = 5))))
# }
```

**Figure `r iFig = iFig + 1; iFig`** Examples of high and low entropy stocks

